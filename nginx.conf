# Sets the max number of simultaneous connections that can be opened by a worker process
events {
    worker_connections 1024;
}

http {

    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;

    server {

        listen 80;

        location /static/ {
            alias /app/staticfiles/;
            expires 7d;
        }
        
        # Serve media files (optional - set this up if needed)
        # location /media/ {
        #     alias /app/mediafiles/;
        #     expires 7d;
        #     access_log off;
        # }

        # Handles all other requests
        location / {
            # Forward requests to Django application
            # proxy_pass http://<service-django-name>:8000;
            proxy_pass http://django:8000;

            # Pass important headers to Django for proper request handling
            proxy_set_header Host $host;                          # Original host header
            proxy_set_header X-Real-IP $remote_addr;              # Client's real IP
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  # Chain of IP addresses
            proxy_set_header X-Forwarded-Proto $scheme;           # Original protocol (http/https)
        }
    }
}
